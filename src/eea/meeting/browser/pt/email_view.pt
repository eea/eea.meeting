<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="eea.meeting"
      metal:use-macro="context/main_template/macros/master">

<head>
    <metal:block fill-slot="style_slot">
        <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++eea.meeting/email_view.css"
            />

        <!--<script tal:define="navroot context/@@plone_portal_state/navigation_root_url"-->
                <!--tal:attributes="href string:${navroot}/++resource++eea.meeting/excel.js"></script>-->

        <script>
            function fnExcelReport() {
    var tab_text = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
    tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';

    tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';
    tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';

    tab_text = tab_text + "<table border='1px'>";
    tab_text = tab_text + $('#myTable').html();
    tab_text = tab_text + '</table></body></html>';

    var data_type = 'data:application/vnd.ms-excel';

    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");

    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
        if (window.navigator.msSaveBlob) {
            var blob = new Blob([tab_text], {
                type: "application/csv;charset=utf-8;"
            });
            navigator.msSaveBlob(blob, 'Test file.xls');
        }
    } else {
        $('#test').attr('href', data_type + ', ' + encodeURIComponent(tab_text));
        $('#test').attr('download', 'Test file.xls');
    }

}
        </script>


    </metal:block>
</head>

<body>
  <metal:block fill-slot="main">
    <h1 class="documentFirstHeading" tal:content="view/label | nothing" />

    <p>This page lists all emails sent to participants.</p>

    <a href="#" id="test" onclick="javascript:fnExcelReport();">Export to Excel</a>

    <!--<button onclick="window.open('data:application/vnd.ms-excel,' + encodeURIComponent(document.getElementsByClassName('display-email')[0].outerHTM‌​L));">-->
            <!--Get as Excel spreadsheet-->
    <!--</button>-->

    <table class="display-email" id="myTable">
        <tr class="display-email-tr">
            <th class="display-email-th">Sender</th>
            <th class="display-email-th">Recipients</th>
            <th class="display-email-th">CC</th>
            <th class="display-email-th">Subject</th>
            <th class="display-email-th">Content</th>
        </tr>

        <tr class="display-email-tr"
            tal:repeat="email view/emails">
            <td class="display-email-td"
                tal:content="email/sender">Email sender</td>
            <td class="display-email-td"
                tal:content="email/receiver">Email receiver</td>
            <td class="display-email-td"
                tal:content="email/cc">Email CC</td>
            <td class="display-email-td"
                tal:content="email/subject">Email subject</td>
            <td class="display-email-td"
                tal:content="email/body">Email body</td>
        </tr>
    </table>

  </metal:block>
</body>
</html>