<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="eea.meeting"
      metal:use-macro="context/main_template/macros/master">

<head>
    <metal:block fill-slot="style_slot">
        <link rel="stylesheet" type="text/css" media="screen" href="++resource++eea.meeting/common.css" />
        <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++eea.meeting/email_view.css"
            />

        <script type="text/javascript" tal:attributes="src string:${portal_url}/++resource++eea.meeting/third-party/FileSaver/FileSaver.min.js"></script>
        <script tal:define="navroot context/@@plone_portal_state/navigation_root_url"
                tal:attributes="src string:${navroot}/++resource++eea.meeting/html_json.js"></script>
        <script tal:define="navroot context/@@plone_portal_state/navigation_root_url"
                tal:attributes="src string:${navroot}/++resource++eea.meeting/excel.js"></script>
        <script src="https://cdn.jsdelivr.net/alasql/0.3/alasql.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.7.12/xlsx.core.min.js"></script>
    </metal:block>
</head>

<body>
  <metal:block fill-slot="content-core">
    <h1 class="documentFirstHeading" tal:content="view/label | nothing" />

    <p>This page lists all emails sent to participants.</p>

    <a href="#" id="btnExport" onclick="saveFile('#listing-table', 'Email Archive', {ignoreColumns: [0]});return false">Export to Excel</a>

    <a class="back-button" tal:attributes="href python:context.aq_parent.absolute_url()">Back to meeting page</a>
    <div class="clearfix"></div>

    <div id="table_wrapper">
        <table class="table table-hover" id="listing-table">
      <thead id="headers">
        <tr class="display-email-tr">
            <th>Receiver</th>
            <th>User Name</th>
            <th>Name</th>
            <th>Surname</th>
            <th>Institution</th>
            <th>From Country</th>
            <th>From City</th>
            <th>Phone Number</th>
            <th>State</th>
            <th>Reimbursed Participation</th>
            <th>Role</th>
        </tr>
      </thead>

      <tbody tal:define="emails view/email_archive">
        <tr tal:condition="not:emails">
          <td colspan="11">No emails sent.</td>
        </tr>
        <tr tal:repeat="email view/email_archive"
            tal:define="roles_dict python:context.aq_parent.get_subscriber_roles_dict();
                        reimbursed_dict python:{True:'yes', False:'no'};">
            <td tal:content="email/receiver">Email receiver</td>
            <td tal:content="email/user_name">User Name</td>
            <td tal:content="email/name">Name</td>
            <td tal:content="email/surname">Surname</td>
            <td tal:content="email/institution">Institution</td>
            <td tal:content="email/from_country">From Country</td>
            <td tal:content="email/from_city">From City</td>
            <td tal:content="email/phone_number">Phone Number</td>
            <td tal:content="email/state">State</td>
            <td tal:content="python:reimbursed_dict.get(email['reimbursed'])">Reimbursed Participation</td>
            <td tal:content="python:roles_dict.get(email['role'])">Role</td>
        </tr>
      </tbody>
    </table>
    </div>

  </metal:block>
</body>
</html>
